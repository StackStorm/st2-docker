
## Building images

```
docker build -t stackstorm/stackstorm:xenial .

docker build -t stackstorm/stackstorm:xenial-2.9.1 --build-arg ST2_VERSION=2.9.1 .
docker build -t stackstorm/stackstorm:xenial-2.9.0 --build-arg ST2_VERSION=2.9.0 .
docker build -t stackstorm/stackstorm:xenial-2.8.1 --build-arg ST2_VERSION=2.8.1 .

docker build -t stackstorm/stackstorm:xenial-dev --build-arg ST2_REPO=unstable --build-arg NODE_REPO=node_8.x .
```

## st2-self-test

```
apt-get -y install uuid-runtime
export ST2_AUTH_TOKEN=$(st2 auth $ST2_USER -p $ST2_PASSWORD -t)
/opt/stackstorm/st2/bin/st2-self-check
```

## Insecure keys

Introduce "insecure" keys in following places.

- st2 datastore key
- SSL self-signed cert for nginx/st2web
- ssh key for stanley user

The idea is like "insecure ssh key" of Vagrant. We save the pre-generated keys in this repo and copy them into the image.

This helps those keys to be consistent among images of different versions/builds. Previously, those are dynamically generated during the docker build process, and it depends on the environment wheter it changes or not because of docker layer caching. This unstableness is considered harmful in both dev/ci and production use case. Leaving the default keys in production also makes the installation vulnerable.

Unlike vagrant, these insecure keys are not replaced at runtime by default. For dev/ci use case, the default insecure key should just work fine. But for production usage, it is strongly recommended to replace them by the one that user generated by their own. This should be mentioned in main README.md to warn users.

## New envvars

- `ST2_DISABLE_MISTRAL`
- `ST2_ENABLE_SSHD`
